# PeelPack 前端 UI 验收标准（Acceptance Criteria）

## 核心问题：什么叫"前端完成"？

每个 Phase 的验收条件应该回答三个问题：
1. **能交互吗？** - 用户能完成核心操作
2. **体验对吗？** - UI 反馈符合预期
3. **怎么证明？** - 可重复的验证方法（手动测试 + 自动化）

## 验收条件设计原则

1. **用户视角** - 从用户操作路径验证，而非技术实现
2. **可见性** - 每个状态都有视觉反馈
3. **容错性** - 异常情况有明确提示和恢复路径
4. **渐进性** - 从核心流程到完整体验到精致细节
5. **跨设备** - 桌面端和移动端都能正常工作

## Phase 1: MVP - 核心流程能跑通吗？

### 任务清单

```bash
□ 1. 初始化 TanStack Start 项目
□ 2. 配置 GraphQL Client（HTTP only）
□ 3. 实现首页生成器（纯文字输入）
□ 4. 实现项目详情页（轮询进度）
□ 5. 实现基础组件（Button/Card/Input）
□ 6. 连接后端 API（Mutation + Query）
□ 7. 展示 9 张情绪表情（简单 Grid）
□ 8. 实现单张图片下载
```

### 验收条件

#### 1. 首页 - 输入与生成

**问题**：用户能否输入描述并触发生成？

**验收标准**：

**测试用例 1.1 - 基础输入**
```
操作步骤：
1. 访问首页 http://localhost:5173/
2. 页面加载后，输入框自动获得焦点
3. 输入"一只可爱的橘猫"
4. 点击"生成贴纸包"按钮

预期结果：
✓ 输入框自动聚焦，无需手动点击
✓ 按钮从禁用状态变为可点击状态
✓ 点击后按钮立即变为"生成中..."并禁用
✓ 1-2 秒内跳转到 /projects/:id 页面
```

**测试用例 1.2 - 输入验证**
```
操作步骤：
1. 访问首页
2. 不输入任何内容
3. 观察生成按钮状态

预期结果：
✓ 按钮为灰色禁用状态
✓ 鼠标悬停时显示"请输入描述"提示（可选）

操作步骤：
4. 输入空格字符"   "
5. 观察按钮状态

预期结果：
✓ 按钮仍为禁用状态（trim 后为空）
```

**测试用例 1.3 - 网络错误处理**
```
操作步骤：
1. 断开网络或停止后端服务
2. 输入描述并点击生成
3. 等待 5-10 秒

预期结果：
✓ 按钮恢复可点击状态（不卡死）
✓ 页面顶部或输入框下方显示红色错误提示
✓ 错误提示包含有用信息："生成失败，请检查网络连接"
✓ 3 秒后错误提示自动消失（或有关闭按钮）
✓ 用户可以重新点击生成按钮
```

**执行验证**：
```bash
# 启动开发环境
cd app && bun run dev

# 手动测试
1. 打开浏览器 http://localhost:5173
2. 按照上述测试用例操作
3. 使用浏览器 DevTools Network 标签模拟网络错误

# 可选：E2E 测试（Playwright）
bun test:e2e tests/phase1/generator.spec.ts
```

#### 2. 项目详情页 - 进度展示

**问题**：用户能否看到生成进度和结果？

**验收标准**：

**测试用例 2.1 - 进度轮询**
```
前置条件：
- 已从首页触发生成，跳转到 /projects/:id
- 后端正在生成图片（generating 状态）

操作步骤：
1. 观察页面内容
2. 等待 5 秒
3. 观察进度更新

预期结果：
✓ 页面显示进度条（例如 "3/9 张完成"）
✓ 显示预计剩余时间（例如 "约 45 秒"）
✓ 九宫格中已完成的图片立即显示（淡入动画）
✓ 未完成的位置显示占位符（灰色背景 + 时钟图标）
✓ 每 5 秒页面自动刷新进度（轮询）
✓ 进度条宽度平滑增长（transition 动画）
```

**测试用例 2.2 - 生成完成**
```
前置条件：
- 所有 9 张图片生成完成（status = completed）

操作步骤：
1. 观察页面变化
2. 检查九宫格展示

预期结果：
✓ 进度条消失或显示 "100% 完成"
✓ 页面顶部显示 "贴纸包已完成 🎉"
✓ 九宫格显示所有 9 张图片
✓ 每张图片清晰可见，加载完整
✓ 图片下方显示情绪标签（开心、难过、生气...）
✓ 不再轮询（Network 标签无新请求）
```

**测试用例 2.3 - 页面刷新恢复**
```
前置条件：
- 生成进行中（5/9 完成）

操作步骤：
1. 按 F5 刷新页面
2. 观察页面恢复情况

预期结果：
✓ 页面正确恢复到当前进度（5/9）
✓ 已完成的 5 张图片立即显示
✓ 继续轮询后续进度
✓ 无数据丢失或重复请求
```

**执行验证**：
```bash
# 手动测试
1. 从首页生成一个项目
2. 在生成过程中观察进度更新
3. 刷新页面验证恢复
4. 等待完成验证最终状态

# 检查 Network 请求
1. 打开 DevTools Network 标签
2. 过滤 GraphQL 请求
3. 验证轮询间隔约为 5 秒
4. 验证完成后停止轮询
```

#### 3. 图片展示 - 九宫格布局

**问题**：9 张情绪表情是否正确展示？

**验收标准**：

**测试用例 3.1 - 布局正确性**
```
前置条件：
- 9 张图片全部生成成功

操作步骤：
1. 观察九宫格布局
2. 调整浏览器窗口大小

预期结果：
✓ 9 张图片排列为 3x3 网格
✓ 图片比例一致（正方形）
✓ 图片间距均匀（gap-4）
✓ 桌面端（> 768px）：每行 3 张
✓ 移动端（< 768px）：每行 3 张（不变）
✓ 图片不变形、不裁剪
```

**测试用例 3.2 - 情绪标签**
```
操作步骤：
1. 检查每张图片的标签

预期结果：
✓ 9 张图片分别标记为：
  - 开心、难过、生气
  - 惊讶、思考、害羞
  - 骄傲、疲倦、爱心
✓ 标签位置一致（图片底部居中）
✓ 标签背景半透明黑色，文字白色
✓ 标签字体清晰可读
```

**测试用例 3.3 - 图片加载**
```
操作步骤：
1. 清除浏览器缓存
2. 刷新页面
3. 观察图片加载过程

预期结果：
✓ 图片加载时显示占位符（灰色背景）
✓ 图片加载完成后淡入显示（opacity 0 → 1）
✓ 加载失败显示"加载失败"提示（不是破裂图标）
✓ 所有图片在 3 秒内加载完成（本地测试）
```

**执行验证**：
```bash
# 手动测试
1. 生成一个完整的项目
2. 使用浏览器检查工具测量布局
3. 截图验证视觉效果

# 响应式测试
1. DevTools 切换到移动设备视图
2. 测试 iPhone SE (375px)
3. 测试 iPad (768px)
4. 测试桌面 (1920px)

# 性能测试
1. DevTools Network 设置 Slow 3G
2. 清除缓存刷新页面
3. 验证图片渐进加载
```

#### 4. 图片下载 - 单张下载

**问题**：用户能否下载单张图片？

**验收标准**：

**测试用例 4.1 - 点击下载**
```
操作步骤：
1. 在九宫格中选择一张图片
2. 鼠标悬停（桌面端）或长按（移动端）
3. 点击"下载"图标或右键菜单

预期结果：
✓ 鼠标悬停时图片略微放大（scale 1.05）
✓ 显示下载图标（右上角或中央）
✓ 点击后触发浏览器下载
✓ 文件名格式正确（例如 "emotion-happy.png"）
✓ 下载的图片与预览一致（无损）
```

**测试用例 4.2 - 右键保存**
```
操作步骤：
1. 右键点击任意图片
2. 选择"图片另存为..."

预期结果：
✓ 浏览器默认保存对话框弹出
✓ 建议文件名有意义（不是 UUID）
✓ 图片格式为 PNG（透明背景）
```

**执行验证**：
```bash
# 手动测试
1. 下载每张图片验证文件名
2. 打开下载的图片验证质量
3. 检查文件大小合理（< 500KB）

# 验证文件内容
file emotion-happy.png
# 输出应为：PNG image data, 512 x 512, 8-bit/color RGBA
```

#### Phase 1 整体验收

**端到端测试场景**：

```
完整用户旅程：
1. 访问首页 → 输入"一只可爱的橘猫" → 点击生成
2. 跳转到进度页 → 看到进度条和实时更新
3. 等待 60-90 秒 → 9 张图片逐个显示
4. 生成完成 → 看到完整的九宫格
5. 点击一张图片 → 成功下载

验收清单：
✓ 整个流程无报错、无卡死
✓ 每个步骤有明确的视觉反馈
✓ 生成时间在 90 秒内（9 张图片）
✓ 最终获得 9 张高质量贴纸图片
✓ 桌面和移动端都能正常工作
```

**性能基准**：
```
- 首页首次加载：< 2s（含 GraphQL Schema）
- 生成按钮响应：< 500ms
- 页面跳转：< 300ms
- 进度轮询延迟：5s ± 0.5s
- 图片加载（单张）：< 1s（本地）
- 整体生成时间：60-90s（9 张图片）
```

---

## Phase 2: 完整体验 - 功能完备了吗？

### 任务清单

```bash
□ 1. 实现风格选择器（网格布局）
□ 2. 集成 GraphQL Subscription（WebSocket）
□ 3. 支持 16 张贴纸（9 情绪 + 7 意外）
□ 4. 实现 Canvas 相框渲染
□ 5. 实现 ZIP 批量下载
□ 6. 实现图片预览 Lightbox
□ 7. 实现失败重试机制
□ 8. 优化动画和交互细节
```

### 验收条件

#### 5. 风格选择器 - 多风格支持

**问题**：用户能否选择不同风格？

**验收标准**：

**测试用例 5.1 - 风格列表加载**
```
操作步骤：
1. 访问首页
2. 观察风格选择区域

预期结果：
✓ 显示所有可用风格（至少 4 个）
✓ 每个风格显示：名称、描述、缩略图（如果有）
✓ 风格卡片排列整齐（2 列移动端，4 列桌面端）
✓ 默认选中"无风格"或第一个预设风格
✓ 加载中显示骨架屏（Skeleton）
```

**测试用例 5.2 - 风格选择交互**
```
操作步骤：
1. 点击"动漫风格"卡片
2. 观察视觉反馈
3. 点击另一个风格
4. 点击生成

预期结果：
✓ 点击时卡片边框高亮（2px → 4px，灰色 → 紫色）
✓ 播放轻微缩放动画（scale 1.0 → 1.05 → 1.0）
✓ 显示"已选择"标记（紫色勾号）
✓ 切换风格时前一个卡片恢复默认样式
✓ 生成时携带选中的 styleId
```

**测试用例 5.3 - 风格预览**
```
操作步骤：
1. 选择"日系动漫"风格
2. 查看描述文字

预期结果：
✓ 显示风格描述（例如"柔和色调的动漫风格"）
✓ 如果有缩略图，显示示例图片
✓ 描述文字不超过 2 行（超出显示省略号）
```

**执行验证**：
```bash
# 手动测试
1. 遍历所有风格选项
2. 每个风格生成一个项目验证效果
3. 对比不同风格的输出差异

# API 验证
curl -X POST http://localhost:3000/graphql \
  -H "Content-Type: application/json" \
  -d '{"query": "{ styles { id displayName description } }"}'
```

#### 6. 实时进度 - Subscription 推送

**问题**：进度更新是否实时（< 1s 延迟）？

**验收标准**：

**测试用例 6.1 - WebSocket 连接**
```
操作步骤：
1. 触发生成，跳转到进度页
2. 打开 DevTools Network → WS 标签
3. 观察 WebSocket 连接

预期结果：
✓ 建立 WebSocket 连接到 ws://localhost:3000/graphql
✓ 连接状态为"已连接"（绿色）
✓ Subscription 订阅消息发送成功
✓ 开始接收 projectProgress 推送
```

**测试用例 6.2 - 实时进度推送**
```
操作步骤：
1. 观察进度页面
2. 用秒表计时每次更新的间隔

预期结果：
✓ 每完成一张图片，1 秒内页面更新
✓ 进度条平滑增长（无跳跃）
✓ 新完成的图片立即显示（淡入动画 300ms）
✓ 剩余时间动态更新（越来越准确）
✓ 无需刷新页面（不是轮询）
```

**测试用例 6.3 - 断线重连**
```
操作步骤：
1. 生成进行中（5/16 完成）
2. 暂停后端服务 5 秒（模拟断线）
3. 恢复后端服务
4. 观察页面行为

预期结果：
✓ 断线时显示"连接中断，正在重连..."提示
✓ 自动尝试重连（3 次）
✓ 重连成功后继续接收推送
✓ 如果重连失败，降级到轮询模式（5s 间隔）
✓ 降级时显示提示："使用轮询模式更新进度"
```

**测试用例 6.4 - 页面刷新恢复**
```
操作步骤：
1. 生成进行中
2. 刷新页面
3. 观察 Subscription 重新订阅

预期结果：
✓ 页面加载后立即查询当前状态（Query）
✓ 如果仍在生成中，重新订阅 Subscription
✓ 继续接收实时推送
✓ 无重复订阅（WS 标签只有一个连接）
```

**执行验证**：
```bash
# 手动测试
1. 生成项目并观察 WebSocket 消息
2. DevTools Console 输入：
   window.wsClient.getConnection().readyState
   # 应输出 1（OPEN）

# 断线测试
1. 生成进行中
2. DevTools Network → WS → 右键断开连接
3. 观察自动重连
4. 或者：systemctl stop peelpack-backend

# 性能验证
1. 记录每次推送的时间戳
2. 计算平均延迟（应 < 1s）
```

#### 7. 意外表情 - 16 张完整贴纸

**问题**：是否正确生成和展示 16 张贴纸？

**验收标准**：

**测试用例 7.1 - 完整生成**
```
操作步骤：
1. 触发生成
2. 等待完成
3. 检查图片数量和分类

预期结果：
✓ 总共生成 16 张图片
✓ 九宫格区域：9 张情绪表情（3x3）
✓ 意外区域：7 张意外表情（1x7 或滚动）
✓ 每张图片都有唯一的 ID
✓ 情绪表情顺序固定（happy → sad → angry...）
✓ 意外表情随机（每次生成不同）
```

**测试用例 7.2 - 意外表情展示**
```
操作步骤：
1. 滚动到意外表情区域
2. 观察布局和样式

预期结果：
✓ 标题显示"意外表情："
✓ 移动端：横向滚动（overflow-x: scroll）
✓ 桌面端：单行显示（7 列）
✓ 每张图片尺寸一致（正方形）
✓ 图片间距合理（gap-3）
✓ 滚动条样式美观（或隐藏）
```

**执行验证**：
```bash
# 手动测试
1. 生成多个项目
2. 对比意外表情的随机性
3. 验证 9 情绪 + 7 意外 = 16 张

# API 验证
curl -X POST http://localhost:3000/graphql \
  -d '{"query": "{ project(id:\"xxx\") { images { category emotionType } } }"}'
# 检查返回 9 个 category=emotion + 7 个 category=surprise
```

#### 8. Canvas 相框 - 实时渲染

**问题**：相框效果是否正确渲染和导出？

**验收标准**：

**测试用例 8.1 - 相框选择**
```
操作步骤：
1. 在结果页面找到相框选择器
2. 切换不同相框样式

预期结果：
✓ 提供至少 4 种相框：无边框、白色描边、圆角、宝丽来
✓ 点击切换时，所有图片立即更新（< 500ms）
✓ 当前选中的相框按钮高亮显示
✓ 相框效果清晰可见（边框宽度、阴影、圆角）
```

**测试用例 8.2 - Canvas 渲染质量**
```
操作步骤：
1. 选择"白色描边"相框
2. 放大查看图片细节
3. 导出图片到本地

预期结果：
✓ 渲染清晰，无锯齿（支持高 DPI）
✓ 边框宽度一致（20px）
✓ 阴影效果自然（rgba(0,0,0,0.2)）
✓ 原始图片不失真
✓ 导出的 PNG 文件包含相框效果
```

**测试用例 8.3 - 性能测试**
```
操作步骤：
1. 切换相框样式
2. 观察页面响应速度
3. 打开 DevTools Performance

预期结果：
✓ 16 张图片同时渲染耗时 < 2s
✓ 切换相框时无明显卡顿（60fps）
✓ CPU 占用合理（< 80%）
✓ 内存占用稳定（无泄漏）
```

**执行验证**：
```bash
# 手动测试
1. 遍历所有相框样式
2. 截图对比渲染效果
3. 导出图片验证质量

# 性能测试
1. DevTools Performance 录制
2. 切换相框 5 次
3. 分析 Canvas 渲染时间

# 验证导出文件
file emotion-happy-framed.png
# 应为：PNG image data, 512 x 512, 8-bit/color RGBA
```

#### 9. ZIP 下载 - 批量打包

**问题**：用户能否一键下载所有贴纸？

**验收标准**：

**测试用例 9.1 - 下载触发**
```
操作步骤：
1. 在结果页面点击"下载全部"按钮
2. 观察按钮状态和进度

预期结果：
✓ 按钮立即变为"打包中..."并禁用
✓ 显示打包进度（"正在下载 5/16..."）
✓ 进度条平滑增长
✓ 5-10 秒后触发浏览器下载
✓ 下载完成后按钮恢复"下载全部"
```

**测试用例 9.2 - ZIP 文件内容**
```
操作步骤：
1. 下载完成后解压 ZIP 文件
2. 检查文件结构和内容

预期结果：
✓ ZIP 文件名格式：peelpack-{projectId}.zip
✓ 内部结构：
  emotions/
    happy.png
    sad.png
    angry.png
    ...（共 9 张）
  surprises/
    01.png
    02.png
    ...（共 7 张）
✓ 所有图片完整无损
✓ 文件大小合理（3-8MB，取决于相框）
```

**测试用例 9.3 - 部分失败处理**
```
前置条件：
- 16 张图片中有 2 张生成失败

操作步骤：
1. 点击"下载全部"
2. 检查下载的 ZIP

预期结果：
✓ 只打包成功的 14 张图片
✓ 跳过失败的图片（不包含在 ZIP 中）
✓ 显示提示："已下载 14 张图片（2 张失败）"
✓ ZIP 文件正常解压
```

**测试用例 9.4 - 网络中断处理**
```
操作步骤：
1. 点击"下载全部"
2. 打包进行中断开网络（5/16）
3. 观察错误处理

预期结果：
✓ 显示错误提示："下载失败，请重试"
✓ 按钮恢复可点击状态
✓ 可以重新下载（不需要刷新页面）
```

**执行验证**：
```bash
# 手动测试
1. 下载 ZIP 并解压
2. 验证文件数量和命名
3. 逐个打开图片检查质量

# 验证 ZIP 结构
unzip -l peelpack-xxx.zip
# 应显示：
#   emotions/happy.png
#   emotions/sad.png
#   ...
#   surprises/01.png
#   ...

# 验证文件完整性
cd emotions && file *.png
# 所有文件应为有效 PNG
```

#### 10. Lightbox 预览 - 图片详情

**问题**：用户能否全屏预览图片？

**验收标准**：

**测试用例 10.1 - 打开预览**
```
操作步骤：
1. 在九宫格或意外行点击任意图片
2. 观察 Lightbox 弹出

预期结果：
✓ 背景变为半透明黑色遮罩（rgba(0,0,0,0.8)）
✓ 图片居中显示，最大化但不超出屏幕
✓ 播放淡入动画（opacity + scale）
✓ 背景模糊（backdrop-blur）可选
✓ 页面滚动被锁定（overflow: hidden）
```

**测试用例 10.2 - 导航切换**
```
操作步骤：
1. Lightbox 打开状态
2. 点击左箭头或按键盘 ←
3. 观察图片切换

预期结果：
✓ 显示前一张图片（带切换动画）
✓ 左右箭头按钮显示在图片两侧
✓ 支持键盘左右箭头键
✓ 到达第一张时左箭头禁用
✓ 到达最后一张时右箭头禁用
✓ 支持触摸滑动（移动端）
```

**测试用例 10.3 - 关闭预览**
```
操作步骤：
1. Lightbox 打开状态
2. 尝试不同关闭方式

预期结果：
✓ 点击背景遮罩关闭
✓ 点击右上角 X 按钮关闭
✓ 按 ESC 键关闭
✓ 播放淡出动画后消失
✓ 页面滚动恢复
✓ 焦点返回到触发的图片
```

**测试用例 10.4 - 图片信息显示**
```
操作步骤：
1. Lightbox 中查看图片
2. 检查显示的元信息

预期结果：
✓ 显示情绪类型或意外序号
✓ 显示生成 Prompt（可选）
✓ 显示图片尺寸（512x512）
✓ 显示生成时间
✓ 提供"下载"按钮
```

**执行验证**：
```bash
# 手动测试
1. 点击每张图片验证 Lightbox
2. 测试键盘导航（← → ESC）
3. 测试触摸滑动（移动端）
4. 验证动画流畅性（60fps）

# 可访问性测试
1. 使用 Tab 键导航
2. 验证焦点陷阱（Focus Trap）
3. 验证 ARIA 属性
4. 验证屏幕阅读器支持
```

#### 11. 错误重试 - 容错机制

**问题**：生成失败的图片能否重试？

**验收标准**：

**测试用例 11.1 - 失败标记**
```
前置条件：
- 16 张图片中有 2 张生成失败

操作步骤：
1. 查看结果页面
2. 定位失败的图片

预期结果：
✓ 失败的位置显示红色边框卡片
✓ 卡片中显示"生成失败"文字
✓ 显示"重试"按钮（红色背景）
✓ 显示错误原因（如果有）
✓ 其他成功的图片正常显示
```

**测试用例 11.2 - 单张重试**
```
操作步骤：
1. 点击失败图片的"重试"按钮
2. 观察重试过程

预期结果：
✓ 按钮立即变为"重试中..."并禁用
✓ 卡片显示加载动画（旋转图标）
✓ 后端重新生成该图片
✓ 成功后图片正常显示（淡入动画）
✓ 如果再次失败，恢复"重试"按钮
```

**测试用例 11.3 - 批量重试**
```
前置条件：
- 多张图片失败（3 张以上）

操作步骤：
1. 在页面顶部找到"重试全部失败"按钮
2. 点击批量重试

预期结果：
✓ 所有失败的图片同时重试
✓ 显示重试进度（"重试中 2/3"）
✓ 成功的图片逐个显示
✓ 如果某张再次失败，单独标记
```

**执行验证**：
```bash
# 模拟失败场景
1. 修改后端代码，随机返回 50% 失败率
2. 生成项目，观察失败处理
3. 点击重试，验证恢复

# 或者：后端限流测试
1. 短时间内生成多个项目
2. 触发 API 限流（429 错误）
3. 验证失败提示和重试机制
```

#### Phase 2 整体验收

**端到端测试场景**：

```
完整用户旅程（完整版）：
1. 访问首页 → 输入描述 → 选择"日系动漫"风格 → 生成
2. 跳转进度页 → 实时看到图片逐个出现（< 1s 延迟）
3. 等待 90 秒 → 16 张图片全部完成
4. 切换相框样式 → 实时预览效果
5. 点击一张图片 → Lightbox 全屏预览
6. 点击"下载全部" → 获得包含 16 张贴纸的 ZIP

验收清单：
✓ 风格选择直观，效果明显
✓ 实时进度推送，无明显延迟
✓ 16 张贴纸分类清晰（9+7）
✓ 相框渲染流畅，切换即时
✓ ZIP 下载完整，结构合理
✓ Lightbox 交互流畅，信息完整
✓ 失败自动重试，用户可手动重试
✓ 所有动画 60fps，无卡顿
```

**性能基准**：
```
- WebSocket 连接建立：< 500ms
- 进度推送延迟：< 1s
- Canvas 渲染（16 张）：< 2s
- 相框切换响应：< 300ms
- ZIP 打包时间：5-10s（16 张图片）
- Lightbox 打开动画：300ms
- 整体生成时间：60-120s（16 张图片）
```

---

## Phase 3: 精致体验 - 细节完美了吗？

### 任务清单

```bash
□ 1. 实现历史列表页（/projects）
□ 2. 实现 Remix 功能
□ 3. 实现相框编辑器（自定义参数）
□ 4. 实现分享功能（生成链接）
□ 5. 优化响应式布局（移动端）
□ 6. 集成用户认证（Better Auth）
□ 7. 添加页面过渡动画
□ 8. SEO 优化（meta 标签）
```

### 验收条件

#### 12. 历史列表 - 项目管理

**问题**：用户能否查看和管理历史项目？

**验收标准**：

**测试用例 12.1 - 列表展示**
```
操作步骤：
1. 访问 /projects 页面
2. 观察项目列表

预期结果：
✓ 显示所有历史项目（按创建时间倒序）
✓ 每个项目显示：
  - 缩略图（第一张图片）
  - 输入描述
  - 风格名称
  - 创建时间（相对时间：2 小时前）
  - 状态标签（完成/生成中/部分失败）
✓ 生成中的项目显示进度（12/16）
✓ 支持分页或无限滚动（20 个/页）
```

**测试用例 12.2 - 快速操作**
```
操作步骤：
1. 在列表中悬停某个项目
2. 观察快速操作按钮

预期结果：
✓ 显示操作按钮：查看、Remix、删除
✓ 点击"查看"跳转到项目详情页
✓ 点击"Remix"携带参数跳转到首页
✓ 点击"删除"弹出确认对话框
✓ 删除后列表自动更新（无需刷新）
```

**测试用例 12.3 - 筛选和排序**
```
操作步骤：
1. 使用筛选器
2. 切换排序方式

预期结果：
✓ 筛选选项：全部/已完成/生成中/部分失败
✓ 排序选项：最新创建/最早创建/最近更新
✓ 筛选和排序立即生效
✓ URL 参数同步更新（可分享）
```

**执行验证**：
```bash
# 手动测试
1. 生成 10+ 个项目
2. 访问历史列表
3. 测试筛选和排序
4. 测试删除功能

# API 验证
curl -X POST http://localhost:3000/graphql \
  -d '{"query": "{ projectArray(limit: 20, orderBy: CREATED_AT_DESC) { nodeArray { id status createdAt } totalCount hasMore } }"}'
```

#### 13. Remix 功能 - 快速迭代

**问题**：用户能否基于已有项目重新生成？

**验收标准**：

**测试用例 13.1 - Remix 触发**
```
操作步骤：
1. 在项目详情页点击"Remix"按钮
2. 观察页面跳转和预填充

预期结果：
✓ 跳转到首页生成器
✓ 输入框自动填充原描述
✓ 风格自动选中原风格
✓ 显示提示："基于项目 #xxx 的 Remix"
✓ 用户可以修改描述或风格
✓ 点击生成创建新项目（不覆盖原项目）
```

**测试用例 13.2 - Remix 链条**
```
操作步骤：
1. 生成项目 A
2. Remix A 生成项目 B
3. Remix B 生成项目 C
4. 查看项目详情

预期结果：
✓ 项目 B 显示"Remix 自项目 A"
✓ 项目 C 显示"Remix 自项目 B"
✓ 点击 Remix 来源可跳转到父项目
✓ 后端记录 remixFromId 字段
✓ 删除父项目不影响子项目（ON DELETE SET NULL）
```

**测试用例 13.3 - 风格变换 Remix**
```
操作步骤：
1. 项目 A 使用"动漫风格"
2. Remix 时切换到"写实风格"
3. 生成并对比结果

预期结果：
✓ 两个项目的描述相同
✓ 风格明显不同
✓ 意外表情可能不同（随机 seed）
✓ 用户可以快速对比多个风格
```

**执行验证**：
```bash
# 手动测试
1. 生成项目 A（动漫风格）
2. Remix 3 次，尝试不同风格
3. 在历史列表查看 Remix 链条
4. 验证每个项目独立存在

# 数据验证
SELECT id, remix_from_id FROM projects WHERE id IN ('A', 'B', 'C');
# B.remix_from_id = A.id
# C.remix_from_id = B.id
```

#### 14. 相框编辑器 - 自定义参数

**问题**：用户能否自定义相框样式？

**验收标准**：

**测试用例 14.1 - 参数调整**
```
操作步骤：
1. 在结果页面打开"相框编辑器"
2. 调整边框宽度滑块（10px - 50px）
3. 观察实时预览

预期结果：
✓ 滑块拖动流畅，实时更新
✓ 边框宽度立即应用到所有图片
✓ 显示当前数值（例如 "20px"）
✓ 预设值：10px / 20px / 30px（快速选择）
```

**测试用例 14.2 - 颜色选择**
```
操作步骤：
1. 点击边框颜色选择器
2. 选择自定义颜色

预期结果：
✓ 弹出颜色选择器（色盘 + 输入框）
✓ 支持 HEX / RGB 输入
✓ 预设常用颜色（白/黑/灰/粉/蓝...）
✓ 颜色实时应用
✓ 保存用户选择（localStorage）
```

**测试用例 14.3 - 高级效果**
```
操作步骤：
1. 切换到"高级"标签
2. 调整阴影、圆角、透明度

预期结果：
✓ 阴影：X 偏移、Y 偏移、模糊、颜色
✓ 圆角：0-50px 滑块
✓ 透明度：0-100% 滑块
✓ 所有参数实时预览
✓ 提供"重置默认"按钮
```

**执行验证**：
```bash
# 手动测试
1. 调整所有参数
2. 截图保存自定义效果
3. 下载验证导出质量

# 性能测试
1. 快速拖动滑块
2. 验证帧率 > 30fps
3. 验证无卡顿和延迟
```

#### 15. 分享功能 - 社交传播

**问题**：用户能否分享作品给他人？

**验收标准**：

**测试用例 15.1 - 生成分享链接**
```
操作步骤：
1. 在项目详情页点击"分享"按钮
2. 观察分享对话框

预期结果：
✓ 生成唯一分享链接（例如 /share/abc123）
✓ 显示二维码（移动端扫码访问）
✓ 提供"复制链接"按钮（一键复制）
✓ 复制成功显示"已复制"提示
✓ 提供社交分享按钮（Twitter/微博...）可选
```

**测试用例 15.2 - 访问分享页面**
```
操作步骤：
1. 复制分享链接
2. 在隐私窗口或其他浏览器打开
3. 观察分享页面

预期结果：
✓ 无需登录即可访问
✓ 显示完整的贴纸包（只读）
✓ 显示创作者信息（可选）
✓ 显示输入描述和风格
✓ 提供"我也要生成"按钮（跳转首页）
✓ 可以查看和下载图片
✓ 不能编辑或删除
```

**测试用例 15.3 - 权限控制**
```
操作步骤：
1. 设置分享权限（公开/仅链接/私密）
2. 测试不同权限下的访问

预期结果：
✓ 公开：搜索引擎可索引，出现在社区画廊
✓ 仅链接：只有知道链接的人能访问
✓ 私密：只有创作者本人能访问
✓ 权限可以随时修改
```

**执行验证**：
```bash
# 手动测试
1. 生成分享链接
2. 在不同设备/浏览器访问
3. 测试权限设置
4. 扫描二维码验证

# API 验证
curl http://localhost:3000/share/abc123
# 应返回完整的项目数据（公开权限）

# 隐私验证
curl http://localhost:3000/share/private123
# 应返回 403 Forbidden
```

#### 16. 响应式布局 - 移动端优化

**问题**：移动端体验是否流畅？

**验收标准**：

**测试用例 16.1 - 移动端首页**
```
设备：iPhone SE (375x667)

操作步骤：
1. 访问首页
2. 测试输入和选择

预期结果：
✓ 输入框占满宽度（padding: 16px）
✓ 风格卡片 2 列布局（gap-3）
✓ 生成按钮占满宽度（height: 48px）
✓ 虚拟键盘弹出时页面正确调整
✓ 所有可点击元素 ≥ 44x44px（触摸友好）
✓ 无横向滚动条
```

**测试用例 16.2 - 移动端进度页**
```
操作步骤：
1. 生成项目，在移动端查看进度
2. 观察布局和交互

预期结果：
✓ 九宫格 3 列布局（不变）
✓ 意外行横向滚动（滑动流畅）
✓ 进度条清晰可见（height: 8px）
✓ 文字大小适中（≥ 14px）
✓ 按钮间距充足（gap-4）
```

**测试用例 16.3 - 触摸手势**
```
操作步骤：
1. 测试各种触摸操作
2. 验证手势支持

预期结果：
✓ 单击打开 Lightbox
✓ 长按保存图片（浏览器原生）
✓ 左右滑动切换 Lightbox 图片
✓ 下拉刷新页面（可选）
✓ 双指缩放图片（Lightbox 中）
✓ 无误触（按钮间距充足）
```

**测试用例 16.4 - 横竖屏切换**
```
操作步骤：
1. 旋转设备
2. 观察布局自适应

预期结果：
✓ 横屏：九宫格保持 3 列
✓ 横屏：意外行显示完整（无需滚动）
✓ 竖屏：恢复竖屏布局
✓ 切换时无内容丢失或错位
✓ 切换动画流畅（transition）
```

**执行验证**：
```bash
# 手动测试设备
1. iPhone SE (375px) - 小屏
2. iPhone 14 Pro (393px) - 中屏
3. iPad Mini (768px) - 平板
4. iPad Pro (1024px) - 大平板

# DevTools 测试
1. Chrome DevTools → Device Mode
2. 测试所有预设设备
3. 自定义尺寸测试边界情况

# 真机测试
1. 使用 ngrok 暴露本地服务
2. 在真机上访问测试
3. 验证触摸反馈和性能
```

#### 17. 用户认证 - 账号系统

**问题**：用户能否注册登录和管理账号？

**验收标准**：

**测试用例 17.1 - 注册流程**
```
操作步骤：
1. 访问首页，点击"登录/注册"
2. 选择注册方式

预期结果：
✓ 提供邮箱注册和 OAuth 登录（Google/GitHub）
✓ 邮箱注册：输入邮箱 + 密码 + 确认密码
✓ 密码强度提示（至少 8 位，包含数字和字母）
✓ 点击"注册"后发送验证邮件（可选）
✓ OAuth 登录：一键授权，自动创建账号
✓ 注册成功后自动登录，跳转首页
```

**测试用例 17.2 - 登录流程**
```
操作步骤：
1. 点击"登录"
2. 输入已注册的邮箱和密码
3. 点击"登录"

预期结果：
✓ 验证邮箱和密码正确性
✓ 错误提示："邮箱或密码错误"
✓ 登录成功后跳转到首页或原页面
✓ Header 显示用户头像和昵称
✓ 项目列表只显示当前用户的项目
✓ Cookie/Token 自动保存（记住登录）
```

**测试用例 17.3 - 权限保护**
```
操作步骤：
1. 未登录状态访问 /projects
2. 尝试生成项目

预期结果：
✓ 跳转到登录页面
✓ 显示提示："请先登录"
✓ 登录后返回原页面（redirect）
✓ 已登录用户直接访问
```

**测试用例 17.4 - 用户设置**
```
操作步骤：
1. 点击头像 → 设置
2. 修改个人信息

预期结果：
✓ 可修改昵称、头像、邮箱
✓ 可修改密码（需输入旧密码）
✓ 可删除账号（需确认）
✓ 修改后立即生效
✓ 删除账号后清除所有数据
```

**执行验证**：
```bash
# 手动测试
1. 注册新账号（邮箱 + OAuth）
2. 登出后重新登录
3. 修改个人信息
4. 测试权限保护

# API 验证
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "password123"}'
# 应返回 session token

# 会话验证
curl http://localhost:3000/graphql \
  -H "Cookie: session=xxx" \
  -d '{"query": "{ me { id email } }"}'
# 应返回当前用户信息
```

#### Phase 3 整体验收

**端到端测试场景（完整产品）**：

```
完整用户旅程（认证版）：
1. 访问首页 → 点击"登录" → Google 账号授权
2. 登录成功 → 输入描述 → 选择风格 → 生成
3. 实时查看进度 → 16 张图片完成
4. 自定义相框 → 调整边框和颜色
5. 下载 ZIP → 分享链接给朋友
6. 朋友打开链接 → 看到作品 → 点击"我也要生成"
7. 访问 /projects → 查看历史 → Remix 一个项目
8. 生成新版本 → 对比不同风格

验收清单：
✓ 用户系统完整（注册/登录/设置）
✓ 历史管理便捷（列表/筛选/删除）
✓ Remix 流程顺畅（快速迭代）
✓ 相框可定制（边框/颜色/阴影）
✓ 分享功能完善（链接/二维码/权限）
✓ 移动端体验优秀（布局/手势/性能）
✓ 所有页面响应式（375px - 1920px）
✓ SEO 友好（meta 标签/sitemap）
```

**性能基准（生产环境）**：
```
- 首页 FCP：< 1.5s
- 首页 LCP：< 2.5s
- TTI（可交互时间）：< 3s
- CLS（布局偏移）：< 0.1
- Lighthouse 分数：> 90
- 移动端性能分数：> 80
```

---

## 验收流程和工具

### 手动测试清单

**Phase 1 测试清单**（30 分钟）：
```
□ 首页输入框自动聚焦
□ 输入验证正常（空值禁用按钮）
□ 点击生成跳转到进度页
□ 进度页轮询更新（每 5 秒）
□ 九宫格布局正确（3x3）
□ 所有图片加载完整
□ 单张图片下载成功
□ 网络错误有提示和重试
```

**Phase 2 测试清单**（60 分钟）：
```
□ 风格选择器交互流畅
□ WebSocket 连接成功
□ 实时进度推送延迟 < 1s
□ 16 张图片分类正确（9+7）
□ 相框切换实时更新
□ ZIP 下载完整（16 张）
□ Lightbox 打开/关闭/切换流畅
□ 失败图片显示重试按钮
□ 重试功能正常工作
□ 断线自动重连或降级轮询
```

**Phase 3 测试清单**（90 分钟）：
```
□ 用户注册/登录/登出
□ 历史列表展示和筛选
□ 项目删除功能
□ Remix 流程完整
□ 相框编辑器参数调整
□ 分享链接生成和访问
□ 移动端布局适配（3 种设备）
□ 触摸手势支持
□ 横竖屏切换正常
□ 权限保护生效
```

### 自动化测试工具

**单元测试**（组件级）：
```bash
# Vitest + React Testing Library
bun test

# 测试覆盖率
bun test --coverage

# 监听模式
bun test --watch
```

**E2E 测试**（用户流程）：
```bash
# Playwright
bun test:e2e

# 特定测试
bun test:e2e tests/phase1/generator.spec.ts

# 有头模式（可见浏览器）
bun test:e2e --headed

# 调试模式
bun test:e2e --debug
```

**可访问性测试**：
```bash
# axe-core
bun test:a11y

# 或使用浏览器扩展
# - Lighthouse (Chrome DevTools)
# - axe DevTools
# - WAVE
```

**性能测试**：
```bash
# Lighthouse CI
npm install -g @lhci/cli
lhci autorun

# 或手动测试
1. Chrome DevTools → Lighthouse
2. 选择"性能"+"最佳实践"+"可访问性"+"SEO"
3. 运行分析
4. 目标：所有分数 > 90
```

### 验收标准模板

每个新功能的验收标准应包含：

```markdown
#### X. 功能名称 - 简短描述

**问题**：要验证什么？

**验收标准**：

**测试用例 X.1 - 场景描述**
\`\`\`
前置条件：（如果有）
- 条件 1
- 条件 2

操作步骤：
1. 步骤 1
2. 步骤 2
3. ...

预期结果：
✓ 结果 1（可观察、可验证）
✓ 结果 2
✓ ...
\`\`\`

**执行验证**：
\`\`\`bash
# 自动化测试命令
bun test path/to/test.ts

# 手动测试步骤
1. 步骤 1
2. 步骤 2

# 验证方法
1. 检查点 1
2. 检查点 2
\`\`\`
```

### 验收会议流程

**Phase 完成后的验收会议**：

1. **演示环节**（15 分钟）
   - 开发者演示核心功能
   - 按照用户旅程操作
   - 展示关键交互和动画

2. **测试环节**（30 分钟）
   - 团队成员实际操作
   - 对照验收清单逐项检查
   - 记录发现的问题

3. **讨论环节**（15 分钟）
   - 讨论发现的问题
   - 区分：阻塞问题 vs 优化建议
   - 确定修复优先级

4. **决策环节**（5 分钟）
   - 决定是否通过验收
   - 通过：进入下一 Phase
   - 不通过：列出必修项，重新验收

### Bug 优先级定义

**P0 - 阻塞性 Bug**（必须立即修复）：
- 核心流程无法完成（无法生成、无法下载）
- 数据丢失或损坏
- 安全漏洞
- 服务崩溃

**P1 - 严重 Bug**（当前 Phase 必须修复）：
- 重要功能异常（风格不生效、进度不更新）
- 明显的视觉错误（布局错乱、图片缺失）
- 性能严重问题（加载超过 10 秒）

**P2 - 一般 Bug**（可延后到下一 Phase）：
- 次要功能异常（标签错位、动画卡顿）
- 边缘情况问题（特定设备/浏览器）
- 用户体验不佳但不影响功能

**P3 - 优化建议**（Product Backlog）：
- 视觉细节优化
- 交互改进建议
- 新功能需求

---

## 总结：验收的本质

验收不是形式主义的检查清单，而是对"完成"的共同理解。每个验收条件都在回答：

1. **这个功能真的可用吗？** - 不是演示可用，而是用户可用
2. **这个体验真的友好吗？** - 不是开发者友好，而是用户友好
3. **这个实现真的可靠吗？** - 不是理想情况可靠，而是异常情况也可靠

好的验收标准应该：
- **具体**：不是"界面美观"，而是"按钮高度 48px，符合触摸标准"
- **可测**：不是"性能良好"，而是"首页加载 < 2s，Lighthouse > 90"
- **必要**：不是"可能用到的功能"，而是"核心流程的关键步骤"

从 Phase 1 到 Phase 3，从核心流程到精致体验，每个 Phase 都是独立可用的产品，而非半成品。验收标准确保我们不是在堆砌功能，而是在打磨体验。

**最终验收问题**：如果现在发布，你会为这个产品感到骄傲吗？
